<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>هايبر شات - مساعد ذكي متطور مع قدرات البرمجة</title>
    <meta name="description" content="هايبر شات - مساعد ذكي متطور من شركة هايبر مانجر بقيادة المهندس خالد النظاري مع قدرات برمجية متقدمة">
    
    <!-- الخطوط والأيقونات -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Cairo:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- مكتبة تسليط الضوء على الكود -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="highlight-theme">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    
    <style>
        :root {
            /* DeepSeek Color Palette */
            --primary-blue: #2563eb;
            --primary-blue-light: #3b82f6;
            --primary-blue-dark: #1d4ed8;
            --secondary-blue: #60a5fa;
            --accent-blue: #93c5fd;
            
            --background-primary: #ffffff;
            --background-secondary: #f8fafc;
            --background-tertiary: #f1f5f9;
            
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --text-light: #94a3b8;
            
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --border-dark: #94a3b8;
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;

            /* ألوان خاصة بالكود */
            --code-background: #0d1117;
            --code-text: #e6edf3;
            --code-border: #30363d;
            --copy-btn-bg: #21262d;
            --copy-btn-hover: #30363d;
            --copy-success: #238636;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Cairo', sans-serif;
            direction: rtl;
            background: var(--background-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            background: var(--background-primary);
            border-bottom: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.25rem;
            position: relative;
            box-shadow: var(--shadow-md);
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue), var(--accent-blue));
            border-radius: var(--radius-lg);
            z-index: -1;
            opacity: 0.3;
            filter: blur(4px);
        }

        .brand-info h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.25rem;
        }

        .brand-info p {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .header-middle {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .engine-badge {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 2.5rem;
            height: 2.5rem;
            border: none;
            background: var(--background-secondary);
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-light);
        }

        .control-btn:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Info Panels */
        .info-panel {
            position: absolute;
            top: 100%;
            right: 1.5rem;
            background: var(--background-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            padding: 1.5rem;
            min-width: 300px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .info-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .panel-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-item {
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-item strong {
            color: var(--text-primary);
        }

        /* Main Chat Area */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            min-height: calc(100vh - 200px);
        }

        .messages-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Message Styles */
        .message {
            display: flex;
            gap: 1rem;
            max-width: 100%;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message.user .message-content {
            align-items: flex-end;
        }

        .message-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue));
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
        }

        .message-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .message-bubble {
            background: var(--background-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-xl);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-sm);
            position: relative;
            max-width: 100%;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
            color: white;
            border: none;
        }

        .message-text {
            font-size: 0.95rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .message-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-light);
        }

        .message.user .message-meta {
            border-top-color: rgba(255, 255, 255, 0.2);
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 2rem;
            height: 2rem;
            border: none;
            background: var(--background-secondary);
            color: var(--text-muted);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
        }

        .action-btn:hover {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.1);
        }

        /* كود البرمجة */
        .code-block {
            background: var(--code-background);
            border: 1px solid var(--code-border);
            border-radius: var(--radius-lg);
            margin: 1rem 0;
            overflow: hidden;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .code-header {
            background: var(--copy-btn-bg);
            border-bottom: 1px solid var(--code-border);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }

        .code-language {
            color: var(--code-text);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .language-icon {
            width: 16px;
            height: 16px;
            border-radius: 2px;
        }

        .copy-code-btn {
            background: var(--copy-btn-bg);
            border: 1px solid var(--code-border);
            color: var(--code-text);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Inter', 'Cairo', sans-serif;
        }

        .copy-code-btn:hover {
            background: var(--copy-btn-hover);
            transform: translateY(-1px);
        }

        .copy-code-btn.success {
            background: var(--copy-success);
            border-color: var(--copy-success);
        }

        .code-content {
            padding: 1rem;
            overflow-x: auto;
            background: var(--code-background);
            color: var(--code-text);
            line-height: 1.5;
            font-size: 0.875rem;
        }

        .code-content pre {
            margin: 0;
            padding: 0;
            background: none;
            color: inherit;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
        }

        .code-content code {
            background: none;
            padding: 0;
            font-family: inherit;
            color: inherit;
            font-size: inherit;
        }

        /* تحسين hljs */
        .hljs {
            background: var(--code-background) !important;
            color: var(--code-text) !important;
            padding: 0 !important;
        }

        /* أزرار إضافية للكود */
        .code-actions {
            background: var(--copy-btn-bg);
            border-top: 1px solid var(--code-border);
            padding: 0.5rem 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .code-action-btn {
            background: var(--copy-btn-bg);
            border: 1px solid var(--code-border);
            color: var(--code-text);
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-family: 'Inter', 'Cairo', sans-serif;
        }

        .code-action-btn:hover {
            background: var(--copy-btn-hover);
            transform: translateY(-1px);
        }

        .code-action-btn i {
            font-size: 0.75rem;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 1rem;
            align-items: center;
            padding: 1rem 0;
        }

        .typing-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .typing-content {
            background: var(--background-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-xl);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            background: var(--background-primary);
            border-top: 1px solid var(--border-light);
            box-shadow: var(--shadow-lg);
            position: sticky;
            bottom: 0;
            z-index: 40;
        }

        .input-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .input-wrapper {
            background: var(--background-secondary);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: flex-end;
            gap: 0.75rem;
            padding: 0.75rem;
            transition: border-color 0.2s ease;
            position: relative;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .input-btn {
            width: 2.75rem;
            height: 2.75rem;
            border: none;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        .record-btn {
            background: var(--background-primary);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
        }

        .record-btn:hover {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.05);
        }

        .record-btn.recording {
            background: #ef4444;
            color: white;
            animation: pulse 1s infinite;
        }

        .send-btn {
            background: var(--primary-blue);
            color: white;
        }

        .send-btn:hover {
            background: var(--primary-blue-dark);
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: var(--border-medium);
            color: var(--text-light);
            cursor: not-allowed;
            transform: none;
        }

        .message-input {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            outline: none;
            min-height: 2.75rem;
            max-height: 200px;
            padding: 0.625rem 0;
            line-height: 1.5;
        }

        .message-input::placeholder {
            color: var(--text-muted);
        }

        .engine-info {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.75rem;
        }

        /* Footer */
        .footer {
            background: var(--background-primary);
            border-top: 1px solid var(--border-light);
            padding: 1rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Dark Mode */
        body.dark {
            --background-primary: #0f172a;
            --background-secondary: #1e293b;
            --background-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --text-light: #64748b;
            --border-light: #334155;
            --border-medium: #475569;
            --border-dark: #64748b;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-container {
                padding: 1rem;
            }

            .brand-info h1 {
                font-size: 1.25rem;
            }

            .brand-info p {
                font-size: 0.75rem;
            }

            .engine-badge {
                font-size: 0.75rem;
                padding: 0.375rem 0.75rem;
            }

            .main-container {
                padding: 1rem;
            }

            .message {
                gap: 0.75rem;
            }

            .message-avatar {
                width: 2rem;
                height: 2rem;
                font-size: 0.875rem;
            }

            .message-bubble {
                padding: 0.75rem 1rem;
            }

            .input-container {
                padding: 1rem;
            }

            .info-panel {
                right: 1rem;
                left: 1rem;
                min-width: auto;
            }

            .code-header {
                padding: 0.5rem 0.75rem;
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .code-actions {
                justify-content: center;
            }
        }

        /* تحسينات إضافية للكود */
        .inline-code {
            background: var(--background-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            padding: 0.125rem 0.375rem;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            font-size: 0.875rem;
            color: var(--primary-blue);
        }

        /* التنبيهات */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--copy-success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.info {
            background: var(--primary-blue);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <!-- Logo Section -->
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-code"></i>
                </div>
                <div class="brand-info">
                    <h1>هايبر شات</h1>
                    <p>مساعد ذكي متطور •</p>
                </div>
            </div>

            <!-- Engine Badge -->
            <div class="header-middle">
                <div class="engine-badge" id="engineBadge">
                    <div class="pulse-dot"></div>
                    <span>هايبر 4</span>
                </div>
            </div>

            <!-- Header Controls -->
            <div class="header-controls">
                <button class="control-btn" id="switchEngineBtn" title="تبديل المحرك">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="control-btn" id="companyInfoBtn" title="معلومات الشركة">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button class="control-btn" id="settingsBtn" title="الإعدادات">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="control-btn" id="darkModeBtn" title="الوضع المظلم">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>

        <!-- Company Info Panel -->
        <div class="info-panel" id="companyInfo">
            <h3 class="panel-title">
                <i class="fas fa-building"></i>
                شركة هايبر مانجر
            </h3>
            <div class="panel-content">
                <div class="info-item"><strong>المطور:</strong> المهندس خالد النظاري</div>
                <div class="info-item"><strong>الهاتف:</strong> 771774634</div>
                <div class="info-item"><strong>التخصص:</strong> حلول الذكاء الاصطناعي المتقدمة</div>
                <div class="info-item"><strong>الرؤية:</strong> ريادة مستقبل التكنولوجيا</div>
                <div class="info-item"><strong>الجديد:</strong> قدرات برمجية متطورة مع تسليط الضوء على الكود</div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="info-panel" id="settingsPanel">
            <h3 class="panel-title">
                <i class="fas fa-cog"></i>
                الإعدادات
            </h3>
            <div class="panel-content">
                <div class="info-item">
                    <strong>المحرك الحالي:</strong> 
                    <span id="currentEngineDisplay">هايبر 4</span>
                </div>
                <div class="info-item">
                    <strong>تفعيل الصوت:</strong> مفعل
                </div>
                <div class="info-item">
                    <strong>إنشاء الصور:</strong> مفعل
                </div>
                <div class="info-item">
                    <strong>تسليط الضوء على الكود:</strong> مفعل
                </div>
                <div class="info-item">
                    <strong>نسخ الكود:</strong> مفعل
                </div>
            </div>
        </div>
    </header>

    <!-- Main Chat Area -->
    <main class="main-container">
        <div class="messages-container" id="messagesContainer">
            <!-- Messages will be rendered here -->
        </div>
    </main>

    <!-- Input Area -->
    <footer class="input-area">
        <div class="input-container">
            <!-- Input Field -->
            <div class="input-wrapper">
                <!-- Record Button -->
                <button class="input-btn record-btn" id="recordBtn" title="التسجيل الصوتي">
                    <i class="fas fa-microphone"></i>
                </button>

                <!-- Text Input -->
                <textarea 
                    id="messageInput" 
                    class="message-input"
                    placeholder="اكتب رسالتك هنا"
                    rows="1"
                ></textarea>

                <!-- Send Button -->
                <button class="input-btn send-btn" id="sendBtn" title="إرسال">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>

            <!-- Engine Info -->
            <div class="engine-info" id="engineInfo">
                مدعوم بـ هايبر 4 • محرك متقدم للمحادثات المعقدة والبرمجة
            </div>
        </div>
    </footer>

    <!-- Footer -->
    <div class="footer">
        <p>هايبر مانجر © 2024 • تطوير المهندس خالد النظاري • نسخة البرمجة المتطورة</p>
    </div>

    <!-- إشعارات -->
    <div class="notification" id="notification"></div>

    <script>
        // Global Variables
        let messages = [];
        let currentEngine = 'hyper4';
        let isDarkMode = false;
        let isTyping = false;
        let isRecording = false;

        // API Keys
        const OPENAI_API_KEY = "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";
        const GEMINI_API_KEY = "AIzaSyCB3r9pWjvxvVS7gKys3naXv8Rk7Ab_n60";

        // DOM Elements
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const recordBtn = document.getElementById('recordBtn');
        const switchEngineBtn = document.getElementById('switchEngineBtn');
        const darkModeBtn = document.getElementById('darkModeBtn');
        const companyInfoBtn = document.getElementById('companyInfoBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const companyInfo = document.getElementById('companyInfo');
        const settingsPanel = document.getElementById('settingsPanel');
        const engineBadge = document.getElementById('engineBadge');
        const currentEngineDisplay = document.getElementById('currentEngineDisplay');
        const engineInfo = document.getElementById('engineInfo');
        const notification = document.getElementById('notification');

        // البرمجة - كلمات مفتاحية للتعرف على طلبات البرمجة
        const PROGRAMMING_KEYWORDS = [
            // عربي
            'اكتب كود', 'أنشئ كود', 'برمج', 'كود', 'دالة', 'فانكشن', 'كلاس', 'فئة',
            'متغير', 'مصفوفة', 'قائمة', 'حلقة تكرار', 'شرط', 'استعلام', 'قاعدة بيانات',
            'الگوریتم', 'خوارزمية', 'مكتبة', 'إطار عمل', 'API', 'JSON', 'XML', 'HTML', 'CSS', 'JavaScript',
            'Python', 'Java', 'C++', 'PHP', 'SQL', 'React', 'Vue', 'Angular', 'Node.js',
            'اكتب برنامج', 'أنشئ تطبيق', 'صمم موقع', 'طور', 'برمجة', 'تطوير',
            // إنجليزي
            'write code', 'create code', 'program', 'function', 'class', 'variable',
            'array', 'list', 'loop', 'condition', 'query', 'database', 'algorithm',
            'library', 'framework', 'script', 'code example', 'coding', 'programming',
            'develop', 'build app', 'create function', 'write script'
        ];

        // لغات البرمجة المدعومة
        const PROGRAMMING_LANGUAGES = {
            'javascript': { name: 'JavaScript', icon: '🟨', color: '#f7df1e' },
            'python': { name: 'Python', icon: '🐍', color: '#3776ab' },
            'html': { name: 'HTML', icon: '🌐', color: '#e34c26' },
            'css': { name: 'CSS', icon: '🎨', color: '#1572b6' },
            'java': { name: 'Java', icon: '☕', color: '#ed8b00' },
            'cpp': { name: 'C++', icon: '⚡', color: '#00599c' },
            'php': { name: 'PHP', icon: '🐘', color: '#777bb4' },
            'sql': { name: 'SQL', icon: '🗃️', color: '#336791' },
            'json': { name: 'JSON', icon: '📋', color: '#000000' },
            'xml': { name: 'XML', icon: '📄', color: '#ff6600' },
            'bash': { name: 'Bash', icon: '💻', color: '#4eaa25' },
            'powershell': { name: 'PowerShell', icon: '🔷', color: '#012456' }
        };

        // Initialize App
        function initApp() {
            // تهيئة highlight.js
            hljs.highlightAll();
            
            addMessage({
                text: `مرحباً بك في هايبر شات المطور! 🚀💻 أنا مساعدك الذكي المتطور من شركة هايبر مانجر مع قدرات برمجية متقدمة.

يمكنني الآن:

• 💬 المحادثة الذكية مع هايبر 4 و هايبر 1
• 🎤 التحدث معك بالصوت  
• 🎨 إنشاء الصور بناءً على وصفك
• 💻 **كتابة أكواد برمجية دقيقة مع تسليط الضوء على النحو**
• 📋 **نسخ الأكواد بسهولة مع أزرار مخصصة**
• 🔧 **شرح الأكواد وتحسينها**
• 🌟 **دعم جميع لغات البرمجة الشائعة**

**جرب طلبات البرمجة مثل:**
• "اكتب كود JavaScript لحساب المتوسط"
• "أنشئ دالة Python لفرز القوائم"
• "كود HTML لصفحة ويب بسيطة"
• "استعلام SQL للبحث في قاعدة البيانات"

كيف يمكنني مساعدتك في البرمجة اليوم؟ 🤖✨`,
                sender: 'ai',
                timestamp: getCurrentTime()
            });

            bindEvents();
            updateEngineUI();
        }

        // Bind Events
        function bindEvents() {
            sendBtn.addEventListener('click', handleSendMessage);
            messageInput.addEventListener('keypress', handleKeyPress);
            messageInput.addEventListener('input', autoResizeTextarea);
            recordBtn.addEventListener('click', toggleRecording);
            switchEngineBtn.addEventListener('click', switchEngine);
            darkModeBtn.addEventListener('click', toggleDarkMode);
            companyInfoBtn.addEventListener('click', toggleCompanyInfo);
            settingsBtn.addEventListener('click', toggleSettings);
        }

        // Handle Key Press
        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        }

        // Auto Resize Textarea
        function autoResizeTextarea() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
        }

        // Get Current Time
        function getCurrentTime() {
            return new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
        }

        // التعرف على طلبات البرمجة
        function isProgrammingRequest(text) {
            const lowerText = text.toLowerCase();
            return PROGRAMMING_KEYWORDS.some(keyword => 
                lowerText.includes(keyword.toLowerCase())
            );
        }

        // تحديد لغة البرمجة من النص
        function detectProgrammingLanguage(text) {
            const lowerText = text.toLowerCase();
            
            // البحث عن لغة محددة في النص
            for (const [key, lang] of Object.entries(PROGRAMMING_LANGUAGES)) {
                if (lowerText.includes(key) || lowerText.includes(lang.name.toLowerCase())) {
                    return key;
                }
            }
            
            // التحقق من الكلمات المرتبطة بلغات معينة
            if (lowerText.includes('موقع') || lowerText.includes('صفحة ويب') || lowerText.includes('website') || lowerText.includes('web page')) {
                return 'html';
            }
            if (lowerText.includes('تصميم') || lowerText.includes('تنسيق') || lowerText.includes('styling') || lowerText.includes('design')) {
                return 'css';
            }
            if (lowerText.includes('قاعدة بيانات') || lowerText.includes('استعلام') || lowerText.includes('database') || lowerText.includes('query')) {
                return 'sql';
            }
            if (lowerText.includes('تعلم آلة') || lowerText.includes('ذكاء اصطناعي') || lowerText.includes('machine learning') || lowerText.includes('ai')) {
                return 'python';
            }
            
            return 'javascript'; // افتراضي
        }

        // إنشاء كتلة الكود
        function createCodeBlock(code, language = 'javascript', explanation = '') {
            const langInfo = PROGRAMMING_LANGUAGES[language] || PROGRAMMING_LANGUAGES['javascript'];
            const codeId = 'code-' + Date.now();
            
            return `
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-language">
                            <span class="language-icon" style="background: ${langInfo.color}">${langInfo.icon}</span>
                            ${langInfo.name}
                        </div>
                        <button class="copy-code-btn" onclick="copyCode('${codeId}')">
                            <i class="fas fa-copy"></i>
                            نسخ الكود
                        </button>
                    </div>
                    <div class="code-content">
                        <pre><code id="${codeId}" class="${language}">${escapeHtml(code)}</code></pre>
                    </div>
                    <div class="code-actions">
                        <button class="code-action-btn" onclick="explainCode('${escapeForJs(code)}', '${language}')">
                            <i class="fas fa-question-circle"></i>
                            شرح الكود
                        </button>
                        <button class="code-action-btn" onclick="improveCode('${escapeForJs(code)}', '${language}')">
                            <i class="fas fa-magic"></i>
                            تحسين الكود
                        </button>
                        <button class="code-action-btn" onclick="runCode('${escapeForJs(code)}', '${language}')">
                            <i class="fas fa-play"></i>
                            تشغيل
                        </button>
                    </div>
                </div>
                ${explanation ? `<div style="margin-top: 1rem; padding: 1rem; background: var(--background-tertiary); border-radius: var(--radius-lg); border-left: 4px solid var(--primary-blue);"><strong>شرح الكود:</strong><br>${explanation}</div>` : ''}
            `;
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Escape for JavaScript
        function escapeForJs(text) {
            return text.replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n');
        }

        // نسخ الكود
        function copyCode(codeId) {
            const codeElement = document.getElementById(codeId);
            if (codeElement) {
                const code = codeElement.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    showNotification('تم نسخ الكود بنجاح! 📋', 'success');
                    
                    // تغيير زر النسخ مؤقتاً
                    const copyBtn = codeElement.closest('.code-block').querySelector('.copy-code-btn');
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> تم النسخ';
                    copyBtn.classList.add('success');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.classList.remove('success');
                    }, 2000);
                }).catch(() => {
                    showNotification('فشل في نسخ الكود', 'error');
                });
            }
        }

        // شرح الكود
        async function explainCode(code, language) {
            const explanation = `شرح الكود بلغة ${PROGRAMMING_LANGUAGES[language]?.name || language}:\n\n${code}`;
            
            addMessage({
                text: explanation,
                sender: 'user',
                timestamp: getCurrentTime()
            });

            isTyping = true;
            showTypingIndicator();

            try {
                const response = await callAIForCodeExplanation(code, language);
                hideTypingIndicator();
                addMessage({
                    text: response,
                    sender: 'ai',
                    timestamp: getCurrentTime()
                });
            } catch (error) {
                hideTypingIndicator();
                addMessage({
                    text: 'عذراً، حدث خطأ في شرح الكود. يرجى المحاولة مرة أخرى.',
                    sender: 'ai',
                    timestamp: getCurrentTime()
                });
            } finally {
                isTyping = false;
            }
        }

        // تحسين الكود
        async function improveCode(code, language) {
            const improvementRequest = `حسن هذا الكود بلغة ${PROGRAMMING_LANGUAGES[language]?.name || language}:\n\n${code}`;
            
            addMessage({
                text: improvementRequest,
                sender: 'user',
                timestamp: getCurrentTime()
            });

            isTyping = true;
            showTypingIndicator();

            try {
                const response = await callAIForCodeImprovement(code, language);
                hideTypingIndicator();
                addMessage({
                    text: response,
                    sender: 'ai',
                    timestamp: getCurrentTime()
                });
            } catch (error) {
                hideTypingIndicator();
                addMessage({
                    text: 'عذراً، حدث خطأ في تحسين الكود. يرجى المحاولة مرة أخرى.',
                    sender: 'ai',
                    timestamp: getCurrentTime()
                });
            } finally {
                isTyping = false;
            }
        }

        // تشغيل الكود (محاكاة)
        function runCode(code, language) {
            if (language === 'javascript') {
                try {
                    // تشغيل JavaScript بحذر
                    const result = eval(code);
                    showNotification(`نتيجة تشغيل الكود: ${result}`, 'info');
                } catch (error) {
                    showNotification(`خطأ في تشغيل الكود: ${error.message}`, 'error');
                }
            } else {
                showNotification(`تشغيل ${PROGRAMMING_LANGUAGES[language]?.name || language} غير مدعوم حالياً في المتصفح`, 'info');
            }
        }

        // عرض الإشعارات
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Add Message
        function addMessage(message) {
            messages.push(message);
            renderMessage(message);
            scrollToBottom();
        }

        // معالجة النصوص التي تحتوي على كود
        function processCodeInText(text) {
            // البحث عن كتل الكود
            const codeBlockRegex = /```(\w+)?\n([\s\S]*?)\n```/g;
            const inlineCodeRegex = /`([^`]+)`/g;
            
            // معالجة كتل الكود
            text = text.replace(codeBlockRegex, (match, language, code) => {
                const lang = language || 'javascript';
                return createCodeBlock(code.trim(), lang);
            });
            
            // معالجة الكود المضمن
            text = text.replace(inlineCodeRegex, (match, code) => {
                return `<span class="inline-code">${escapeHtml(code)}</span>`;
            });
            
            return text;
        }

        // Render Message
        function renderMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.sender}`;
            
            let processedText = message.text;
            
            // معالجة الكود في النص
            if (message.sender === 'ai') {
                processedText = processCodeInText(processedText);
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas ${message.sender === 'user' ? 'fa-user' : 'fa-robot'}"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        ${message.imageUrl ? `
                            <div style="margin-bottom: 1rem;">
                                <img src="${message.imageUrl}" alt="صورة مولدة" style="width: 100%; max-width: 400px; border-radius: 0.75rem; box-shadow: var(--shadow-md);" loading="lazy">
                            </div>
                        ` : ''}
                        
                        <div class="message-text">${processedText}</div>
                        
                        <div class="message-meta">
                            <span class="message-time">${message.timestamp}</span>
                            ${message.sender === 'ai' ? `
                                <div class="message-actions">
                                    <button class="action-btn" onclick="playTextToSpeech('${escapeForJs(message.text)}')" title="تشغيل الصوت">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                    <button class="action-btn" onclick="copyMessage('${escapeForJs(message.text)}')" title="نسخ">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button class="action-btn" onclick="regenerateResponse(${messages.length - 1})" title="إعادة توليد">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(messageDiv);
            
            // تطبيق highlight.js على الكود الجديد
            if (message.sender === 'ai') {
                messageDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }
        }

        // Show Typing Indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="typing-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="typing-content">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        // Hide Typing Indicator
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Scroll to Bottom
        function scrollToBottom() {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        // Check if About Developer
        function isAboutDeveloper(text) {
            const aboutKeywords = ['من أنت', 'من صنعك', 'من طورك', 'من المطور', 'معلومات عنك', 'خالد النظاري', 'هايبر مانجر'];
            return aboutKeywords.some(keyword => text.includes(keyword));
        }

        // Get Developer Response
        function getDeveloperResponse() {
            return `أنا هايبر شات، مساعد ذكي متطور من تطوير شركة هايبر مانجر بقيادة المهندس خالد النظاري.

🏢 **عن الشركة:**
• **الاسم:** شركة هايبر مانجر
• **المؤسس:** المهندس خالد النظاري
• **التخصص:** حلول الذكاء الاصطناعي المتقدمة والبرمجة
• **الهاتف:** 771774634

💻 **قدراتي الجديدة:**
• محادثة ذكية متقدمة
• إنشاء وتحليل الأكواد البرمجية
• دعم جميع لغات البرمجة الشائعة
• تسليط الضوء على النحو والتنسيق
• نسخ الأكواد بسهولة
• شرح وتحسين الأكواد

🚀 **الرؤية:** ريادة مستقبل التكنولوجيا وتطوير حلول برمجية متطورة`;
        }

        // Check if Image Request
        function isImageRequest(text) {
            const imageKeywords = ['ارسم', 'اصنع صورة', 'أنشئ صورة', 'صورة', 'رسم', 'تصميم', 'draw', 'create image', 'generate image'];
            return imageKeywords.some(keyword => text.includes(keyword));
        }

        // تحسين prompt للبرمجة
        function createProgrammingPrompt(userMessage) {
            const language = detectProgrammingLanguage(userMessage);
            const langInfo = PROGRAMMING_LANGUAGES[language];
            
            return `أنت هايبر شات، مساعد ذكي متطور متخصص في البرمجة من تطوير شركة هايبر مانجر بقيادة المهندس خالد النظاري.

المطلوب: ${userMessage}

تعليمات مهمة للبرمجة:
1. اكتب كود عالي الجودة وفعال
2. أضف تعليقات توضيحية بالعربية
3. استخدم أفضل الممارسات في البرمجة
4. تنسيق الكود: \`\`\`${language}
5. اشرح الكود باختصار بعد كتابته
6. إذا كان الكود معقد، قسمه لأجزاء صغيرة

اللغة المحتملة: ${langInfo?.name || 'JavaScript'}
استخدم هذا التنسيق للكود:
\`\`\`${language}
// الكود هنا
\`\`\`

تجيب باللغة العربية بطريقة ودودة ومفيدة ودقيقة في البرمجة.`;
        }

        // Call AI for Code Explanation
        async function callAIForCodeExplanation(code, language) {
            const prompt = `اشرح هذا الكود بلغة ${PROGRAMMING_LANGUAGES[language]?.name || language} بالتفصيل:

\`\`\`${language}
${code}
\`\`\`

اشرح:
1. ماذا يفعل الكود
2. كيف يعمل كل جزء
3. المفاهيم المستخدمة
4. أي نصائح أو تحسينات`;

            if (currentEngine === 'hyper4') {
                return await callHyper4API(prompt);
            } else {
                return await callHyper1API(prompt);
            }
        }

        // Call AI for Code Improvement
        async function callAIForCodeImprovement(code, language) {
            const prompt = `حسن هذا الكود بلغة ${PROGRAMMING_LANGUAGES[language]?.name || language}:

\`\`\`${language}
${code}
\`\`\`

اقترح تحسينات في:
1. الأداء والكفاءة
2. قابلية القراءة
3. أفضل الممارسات
4. إضافة تعليقات توضيحية
5. معالجة الأخطاء إذا لزم الأمر

اكتب النسخة المحسنة كاملة.`;

            if (currentEngine === 'hyper4') {
                return await callHyper4API(prompt);
            } else {
                return await callHyper1API(prompt);
            }
        }

        // Call Hyper 4 API (OpenAI)
        async function callHyper4API(message) {
            try {
                const isProgramming = isProgrammingRequest(message);
                const systemPrompt = isProgramming ? 
                    createProgrammingPrompt(message) : 
                    'أنت هايبر شات، مساعد ذكي متطور من تطوير شركة هايبر مانجر بقيادة المهندس خالد النظاري. تجيب باللغة العربية بطريقة ودودة ومفيدة. لا تذكر أبداً أنك ChatGPT أو من OpenAI، أنت هايبر شات فقط.';

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: isProgramming ? message : message
                            }
                        ],
                        max_tokens: isProgramming ? 2000 : 1000,
                        temperature: isProgramming ? 0.3 : 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error('فشل في الاتصال بهايبر 4');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('خطأ في هايبر 4:', error);
                return await callHyper1API(message);
            }
        }

        // Call Hyper 1 API (Gemini)
        async function callHyper1API(message) {
            try {
                const isProgramming = isProgrammingRequest(message);
                const systemPrompt = isProgramming ?
                    createProgrammingPrompt(message) :
                    `أنت هايبر شات، مساعد ذكي متطور من تطوير شركة هايبر مانجر بقيادة المهندس خالد النظاري. تجيب باللغة العربية بطريقة ودودة ومفيدة. لا تذكر أبداً أنك Gemini أو من Google، أنت هايبر شات فقط. السؤال: ${message}`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: isProgramming ? systemPrompt : systemPrompt
                            }]
                        }],
                        generationConfig: {
                            temperature: isProgramming ? 0.3 : 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: isProgramming ? 2000 : 1000,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('فشل في الاتصال بهايبر 1');
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('خطأ في هايبر 1:', error);
                return 'عذراً، حدث خطأ في الاتصال. يرجى المحاولة مرة أخرى.';
            }
        }

        // Generate Image via OpenAI DALL-E
        async function generateImage(prompt) {
            try {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "dall-e-3",
                        prompt: prompt,
                        n: 1,
                        size: "1024x1024",
                        quality: "standard"
                    })
                });

                if (!response.ok) {
                    throw new Error('فشل في إنشاء الصورة');
                }

                const data = await response.json();
                return data.data[0].url;
            } catch (error) {
                console.error('خطأ في إنشاء الصورة:', error);
                throw error;
            }
        }

        // Handle Send Message
        async function handleSendMessage() {
            const text = messageInput.value.trim();
            if (!text || isTyping) return;

            addMessage({
                text: text,
                sender: 'user',
                timestamp: getCurrentTime()
            });

            messageInput.value = '';
            autoResizeTextarea();

            isTyping = true;
            showTypingIndicator();

            try {
                let response;
                let imageUrl = null;

                if (isAboutDeveloper(text)) {
                    response = getDeveloperResponse();
                } else if (isImageRequest(text)) {
                    try {
                        imageUrl = await generateImage(text);
                        response = 'تم إنشاء الصورة بنجاح! 🎨✨';
                    } catch (error) {
                        response = 'عذراً، حدث خطأ في إنشاء الصورة. يرجى المحاولة مرة أخرى.';
                    }
                } else {
                    if (currentEngine === 'hyper4') {
                        response = await callHyper4API(text);
                    } else {
                        response = await callHyper1API(text);
                    }
                }

                hideTypingIndicator();
                addMessage({
                    text: response,
                    sender: 'ai',
                    timestamp: getCurrentTime(),
                    imageUrl: imageUrl
                });

            } catch (error) {
                console.error('خطأ في إرسال الرسالة:', error);
                hideTypingIndicator();
                addMessage({
                    text: 'عذراً، حدث خطأ في الاتصال. يرجى المحاولة مرة أخرى.',
                    sender: 'ai',
                    timestamp: getCurrentTime()
                });
            } finally {
                isTyping = false;
            }
        }

        // Switch Engine
        function switchEngine() {
            currentEngine = currentEngine === 'hyper4' ? 'hyper1' : 'hyper4';
            updateEngineUI();
            showNotification(`تم التبديل إلى ${getEngineInfo().name}`, 'info');
        }

        // Update Engine UI
        function updateEngineUI() {
            const engineInfo = getEngineInfo();
            engineBadge.querySelector('span').textContent = engineInfo.name;
            currentEngineDisplay.textContent = engineInfo.name;
            document.getElementById('engineInfo').textContent = `مدعوم بـ ${engineInfo.name} • ${engineInfo.description}`;
        }

        // Get Engine Info
        function getEngineInfo() {
            return currentEngine === 'hyper4' 
                ? { name: 'هايبر 4', description: 'محرك متقدم للمحادثات المعقدة والبرمجة' }
                : { name: 'هايبر 1', description: 'محرك سريع للردود الفورية والبرمجة' };
        }

        // Toggle Dark Mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            
            // تغيير theme highlight.js
            const highlightTheme = document.getElementById('highlight-theme');
            if (isDarkMode) {
                highlightTheme.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css';
            } else {
                highlightTheme.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
            }
            
            // إعادة تطبيق highlight
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            showNotification(`تم تفعيل ${isDarkMode ? 'الوضع المظلم' : 'الوضع المضيء'}`, 'info');
        }

        // Toggle Company Info
        function toggleCompanyInfo() {
            companyInfo.classList.toggle('show');
            settingsPanel.classList.remove('show');
        }

        // Toggle Settings
        function toggleSettings() {
            settingsPanel.classList.toggle('show');
            companyInfo.classList.remove('show');
        }

        // Toggle Recording
        function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        // Start Recording
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                isRecording = true;
                recordBtn.classList.add('recording');
                recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
                
                showNotification('بدء التسجيل الصوتي...', 'info');
                
            } catch (error) {
                console.error('خطأ في الوصول للميكروفون:', error);
                showNotification('لا يمكن الوصول إلى الميكروفون', 'error');
            }
        }

        // Stop Recording
        function stopRecording() {
            isRecording = false;
            recordBtn.classList.remove('recording');
            recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            showNotification('تم إيقاف التسجيل', 'info');
        }

        // Play Text to Speech
        function playTextToSpeech(text) {
            if ('speechSynthesis' in window) {
                // إيقاف أي صوت قيد التشغيل
                speechSynthesis.cancel();
                
                // إزالة الكود من النص للقراءة
                const cleanText = text.replace(/```[\s\S]*?```/g, 'كود برمجي').replace(/`[^`]+`/g, 'كود');
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                
                speechSynthesis.speak(utterance);
                showNotification('جاري تشغيل الصوت...', 'info');
            } else {
                showNotification('المتصفح لا يدعم تحويل النص إلى صوت', 'error');
            }
        }

        // Copy Message
        function copyMessage(text) {
            // إزالة HTML tags والكود من النص
            const cleanText = text.replace(/<[^>]*>/g, '').replace(/```[\s\S]*?```/g, '[كود برمجي]');
            
            navigator.clipboard.writeText(cleanText).then(() => {
                showNotification('تم نسخ الرسالة', 'success');
            }).catch(() => {
                showNotification('فشل في نسخ الرسالة', 'error');
            });
        }

        // Regenerate Response
        async function regenerateResponse(messageIndex) {
            if (messageIndex > 0 && messages[messageIndex - 1]) {
                const userMessage = messages[messageIndex - 1];
                
                isTyping = true;
                showTypingIndicator();
                
                try {
                    let response;
                    
                    if (isAboutDeveloper(userMessage.text)) {
                        response = getDeveloperResponse();
                    } else if (isImageRequest(userMessage.text)) {
                        try {
                            const imageUrl = await generateImage(userMessage.text);
                            response = 'تم إنشاء الصورة بنجاح! 🎨✨';
                            messages[messageIndex].imageUrl = imageUrl;
                        } catch (error) {
                            response = 'عذراً، حدث خطأ في إنشاء الصورة. يرجى المحاولة مرة أخرى.';
                        }
                    } else {
                        if (currentEngine === 'hyper4') {
                            response = await callHyper4API(userMessage.text);
                        } else {
                            response = await callHyper1API(userMessage.text);
                        }
                    }
                    
                    hideTypingIndicator();
                    messages[messageIndex].text = response;
                    messages[messageIndex].timestamp = getCurrentTime();
                    
                    // Re-render messages
                    messagesContainer.innerHTML = '';
                    messages.forEach(msg => renderMessage(msg));
                    
                } catch (error) {
                    console.error('خطأ في إعادة التوليد:', error);
                    hideTypingIndicator();
                } finally {
                    isTyping = false;
                }
            }
        }

        // إغلاق اللوحات عند النقر خارجها
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.header-controls') && !e.target.closest('.info-panel')) {
                companyInfo.classList.remove('show');
                settingsPanel.classList.remove('show');
            }
        });

        // Initialize App on DOM Content Loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

<style>
#minimax-floating-ball {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 10px 12px;
  background: #222222;
  border-radius: 12px;
  display: flex;
  align-items: center;
  color: #F8F8F8;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  z-index: 9999;
  transition: all 0.3s ease;
  overflow: hidden;
  cursor: pointer;
}

#minimax-floating-ball:hover {
  transform: translateY(-2px);
  background: #383838;
}

.minimax-ball-content {
  display: flex;
  align-items: center;
  gap: 8px;
}

.minimax-logo-wave {
  width: 26px;
  height: 22px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='26' height='22' viewBox='0 0 26 22' fill='none'%3E%3Cg clip-path='url(%23clip0_3442_102412)'%3E%3Cpath d='M12.8405 14.6775C12.8405 14.9897 13.0932 15.2424 13.4055 15.2424C13.7178 15.2424 13.9705 14.9897 13.9705 14.6775V2.98254C13.9705 1.88957 13.0809 1 11.9879 1C10.895 1 10.0054 1.88957 10.0054 2.98254V11.566V17.1068C10.0054 17.5773 9.62327 17.9594 9.1528 17.9594C8.68233 17.9594 8.30021 17.5773 8.30021 17.1068V8.04469C8.30021 6.95172 7.41063 6.06215 6.31767 6.06215C5.22471 6.06215 4.33513 6.95172 4.33513 8.04469V11.8855C4.33513 12.3559 3.953 12.7381 3.48254 12.7381C3.01207 12.7381 2.62994 12.3559 2.62994 11.8855V10.4936C2.62994 10.1813 2.37725 9.92861 2.06497 9.92861C1.7527 9.92861 1.5 10.1813 1.5 10.4936V11.8855C1.5 12.9784 2.38957 13.868 3.48254 13.868C4.5755 13.868 5.46508 12.9784 5.46508 11.8855V8.04469C5.46508 7.57422 5.8472 7.19209 6.31767 7.19209C6.78814 7.19209 7.17026 7.57422 7.17026 8.04469V17.1068C7.17026 18.1998 8.05984 19.0894 9.1528 19.0894C10.2458 19.0894 11.1353 18.1998 11.1353 17.1068V2.98254C11.1353 2.51207 11.5175 2.12994 11.9879 2.12994C12.4584 2.12994 12.8405 2.51207 12.8405 2.98254V14.6775Z' fill='%23F8F8F8'/%3E%3Cpath d='M23.3278 6.06215C22.2348 6.06215 21.3452 6.95172 21.3452 8.04469V15.6143C21.3452 16.0847 20.9631 16.4669 20.4926 16.4669C20.0222 16.4669 19.6401 16.0847 19.6401 15.6143V2.98254C19.6401 1.88957 18.7505 1 17.6575 1C16.5645 1 15.675 1.88957 15.675 2.98254V19.0175C15.675 19.4879 15.2928 19.8701 14.8224 19.8701C14.3519 19.8701 13.9698 19.4879 13.9698 19.0175V17.0329C13.9698 16.7206 13.7171 16.4679 13.4048 16.4679C13.0925 16.4679 12.8398 16.7206 12.8398 17.0329V19.0175C12.8398 20.1104 13.7294 21 14.8224 21C15.9153 21 16.8049 20.1104 16.8049 19.0175V2.98254C16.8049 2.51207 17.187 2.12994 17.6575 2.12994C18.128 2.12994 18.5101 2.51207 18.5101 2.98254V15.6143C18.5101 16.7072 19.3997 17.5968 20.4926 17.5968C21.5856 17.5968 22.4752 16.7072 22.4752 15.6143V8.04469C22.4752 7.57422 22.8573 7.19209 23.3278 7.19209C23.7982 7.19209 24.1804 7.57422 24.1804 8.04469V14.6775C24.1804 14.9897 24.4331 15.2424 24.7453 15.2424C25.0576 15.2424 25.3103 14.9897 25.3103 14.6775V8.04469C25.3103 6.95172 24.4207 6.06215 23.3278 6.06215Z' fill='%23F8F8F8'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id='clip0_3442_102412'%3E%3Crect width='25' height='22' fill='white' transform='translate(0.5)'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
}

.minimax-ball-text {
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
}

.minimax-close-icon {
  margin-left: 8px;
  font-size: 16px;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.minimax-close-icon:hover {
  opacity: 1;
}
</style>
<div id="minimax-floating-ball">
  <div class="minimax-ball-content">
    <div class="minimax-logo-wave"></div>
    <span class="minimax-ball-text">Created by MiniMax Agent</span>
  </div>
  <div class="minimax-close-icon">×</div>
</div>
<script>
// Initialize floating ball functionality
function initFloatingBall() {
  const ball = document.getElementById('minimax-floating-ball');
  if (!ball) return;

  // Initial animation
  ball.style.opacity = '0';
  ball.style.transform = 'translateY(20px)';

  setTimeout(() => {
    ball.style.opacity = '1';
    ball.style.transform = 'translateY(0)';
  }, 500);

  // Handle logo click
  const ballContent = ball.querySelector('.minimax-ball-content');
  ballContent.addEventListener('click', function (e) {
    e.stopPropagation();
    window.open('https://agent.minimax.io/agent', '_blank');
    ball.style.transform = 'scale(0.95)';
    setTimeout(() => {
      ball.style.transform = 'scale(1)';
    }, 100);
  });

  // Handle close button click
  const closeIcon = ball.querySelector('.minimax-close-icon');
  closeIcon.addEventListener('click', function (e) {
    e.stopPropagation();
    ball.style.opacity = '0';
    ball.style.transform = 'translateY(20px)';

    setTimeout(() => {
      ball.style.display = 'none';
    }, 300);
  });
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', initFloatingBall); 
</script>

</body>
</html>
