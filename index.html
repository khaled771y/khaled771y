<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<title>Ù‡Ø§ÙŠØ¨Ø± Ø´Ø§Øª Ultra-4K | Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø®Ø§Ø±Ù‚Ø©</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="description" content="Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙŠØªØ°ÙƒÙ‘Ø± ÙˆÙŠØªÙØ§Ø¹Ù„ Ù…Ø¹Ùƒ â€“ Ù…Ù† ØªØ·ÙˆÙŠØ± Ù‡Ø§ÙŠØ¨Ø± Ù…Ø§Ù†Ø¬Ø±"/>
<meta name="theme-color" content="#0d1117"/>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi2KfZhNiq2K3Yp9mEINin2YTYqtmF2KfZhtin2YciLCJzaG9ydF9uYW1lIjoi2KfZhNiq2K3Yp9mEIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwZDExMTciLCJ0aGVtZV9jb2xvciI6IiMyNTYzZWIifQ=="/>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§ </text></svg>"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..900&family=Cairo:wght@300..900&family=JetBrains+Mono:wght@300..700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
<style>
:root{
  --brand:#2563eb;
  --brand-light:#3b82f6;
  --brand-dark:#1e40af;
  --bg:oklch(99% 0 0);
  --bg-secondary:oklch(98.5% 0 0);
  --bg-tertiary:oklch(97% 0 0);
  --glass:color-mix(in srgb,var(--bg) 60%,transparent);
  --text:oklch(20% 0 0);
  --text-secondary:oklch(40% 0 0);
  --text-muted:oklch(55% 0 0);
  --border:oklch(90% 0 0);
  --radius:1.25rem;
  --shadow:0 0 0 1px var(--border),0 8px 32px -8px rgba(0,0,0,.06);
  --shadow-lg:0 0 0 1px var(--border),0 16px 64px -16px rgba(0,0,0,.1);
  --ease:cubic-bezier(.4,0,.2,1);
}
[data-theme="dark"]{
  --bg:oklch(15% .01 240);
  --bg-secondary:oklch(18% .01 240);
  --bg-tertiary:oklch(22% .01 240);
  --glass:color-mix(in srgb,var(--bg) 60%,transparent);
  --text:oklch(95% 0 0);
  --text-secondary:oklch(80% .01 240);
  --text-muted:oklch(65% .01 240);
  --border:oklch(30% .01 240);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:"Inter","Cairo",system-ui,sans-serif;color:var(--text);background:linear-gradient(145deg,var(--bg-secondary),var(--bg));display:flex;flex-direction:column;scroll-behavior:smooth}
header{position:sticky;top:0;z-index:30;backdrop-filter:blur(36px);background:var(--glass);border-bottom:1px solid var(--border)}
.header-inner{max-width:1440px;margin:0 auto;padding:1rem 2rem;display:flex;align-items:center;gap:1rem}
.logo{display:flex;align-items:center;gap:.5rem;font-weight:800;font-size:1.4rem;color:var(--brand)}
.logo i{width:2.2rem;height:2.2rem;display:grid;place-items:center;background:linear-gradient(135deg,var(--brand),var(--brand-light));color:#fff;border-radius:.6rem}
.controls{display:flex;gap:.5rem}
.btn-icon{width:2.5rem;height:2.5rem;border-radius:.6rem;display:grid;place-items:center;color:var(--text-secondary);transition:background .2s var(--ease)}
.btn-icon:hover{background:var(--bg-tertiary);color:var(--brand)}
main{flex:1;display:flex;max-width:1440px;margin:0 auto;width:100%;padding:2rem}
.chat{flex:1;display:flex;flex-direction:column;gap:2rem}
.messages{flex:1;display:flex;flex-direction:column;gap:2rem;overflow-y:auto;padding-bottom:2rem}
.msg{display:flex;gap:1rem;align-items:flex-start}
.msg.user{flex-direction:row-reverse}
.avatar{width:3rem;height:3rem;border-radius:50%;flex-shrink:0;display:grid;place-items:center;font-size:1.2rem;color:#fff;background:linear-gradient(135deg,var(--brand),var(--brand-light))}
.bubble{max-width:min(70ch,100%);padding:1.25rem 1.75rem;border-radius:var(--radius);background:var(--bg-secondary);box-shadow:var(--shadow);position:relative}
.msg.user .bubble{background:linear-gradient(135deg,var(--brand),var(--brand-light));color:#fff}
.typing{display:flex;gap:.35rem}
.typing span{width:.6rem;height:.6rem;border-radius:50%;background:var(--text-muted);animation:dot 1.4s infinite}
.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}
@keyframes dot{0%,80%,100%{opacity:.4}40%{opacity:1}}
.input-area{position:sticky;bottom:0;backdrop-filter:blur(36px);background:var(--glass);border-top:1px solid var(--border);padding:1.5rem 2rem;display:flex;justify-content:center}
.input-wrapper{max-width:1440px;flex:1;display:flex;gap:.5rem;align-items:flex-end;padding:.75rem 1rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);transition:box-shadow .2s var(--ease)}
.input-wrapper:focus-within{box-shadow:0 0 0 2px var(--brand),var(--shadow-lg)}
textarea{flex:1;border:none;background:transparent;resize:none;max-height:10rem;min-height:2.75rem;outline:none;font-size:1.05rem}
.btn-send,.btn-mic{width:2.75rem;height:2.75rem;border-radius:.6rem;display:grid;place-items:center;color:#fff;background:linear-gradient(135deg,var(--brand),var(--brand-light));transition:background .2s var(--ease)}
.btn-send:disabled,.btn-mic:disabled{opacity:.5;cursor:not-allowed}
.btn-send:not(:disabled):hover,.btn-mic:not(:disabled):hover{background:var(--brand-dark)}
.code-block{margin:1.25rem 0;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:var(--bg-secondary)}
.code-header{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;background:var(--bg-tertiary);font-size:.85rem;color:var(--text-secondary)}
.code-actions{display:flex;gap:.25rem}
.code-btn{padding:.35rem .65rem;border-radius:.4rem;background:var(--bg);color:var(--text);font-size:.75rem}
.code-btn:hover{background:var(--brand);color:#fff}
@media(max-width:768px){
 .header-inner,main,.input-area{padding:1rem}
}
</style>
</head>
<body data-theme="light">
<header>
  <div class="header-inner">
    <div class="logo">
      <i class="fas fa-rocket"></i>
      <span>Ù‡Ø§ÙŠØ¨Ø± Ø´Ø§Øª Ultra-4K</span>
    </div>
    <div class="controls">
      <button class="btn-icon" id="btnTheme" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…"><i class="fas fa-moon"></i></button>
      <button class="btn-icon" id="btnInfo" title="Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©"><i class="fas fa-info-circle"></i></button>
    </div>
  </div>
</header>

<main>
  <div class="chat">
    <div class="messages" id="messages"></div>
  </div>
</main>

<footer class="input-area">
  <div class="input-wrapper">
    <button class="btn-mic" id="btnMic" title="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ"><i class="fas fa-microphone"></i></button>
    <textarea id="input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†â€¦" rows="1"></textarea>
    <button class="btn-send" id="btnSend" title="Ø¥Ø±Ø³Ø§Ù„"><i class="fas fa-paper-plane"></i></button>
  </div>
</footer>

<script>
/* ---------- CONFIG ---------- */
const GEMINI_KEY   = 'AIzaSyBq-vfVMJWeN3r1DA4prKzfx1UhpMiKZwM';   // Gemini fallback
const OPENAI_KEY   = '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'; // GPT-4o
const $ = sel => document.querySelector(sel);

/* ---------- THEME ---------- */
const applyTheme = () => {
  const dark = localStorage.theme === "dark" || 
               (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches);
  document.body.dataset.theme = dark ? "dark" : "light";
  $("#btnTheme i").className = dark ? "fas fa-sun" : "fas fa-moon";
};
applyTheme();
$("#btnTheme").onclick = () => {
  localStorage.theme = localStorage.theme === "dark" ? "light" : "dark";
  applyTheme();
};

/* ---------- MEMORY ---------- */
const STORAGE_KEY = "hyperChat_memory";
const loadMemory = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
const saveMemory = msgs => localStorage.setItem(STORAGE_KEY, JSON.stringify(msgs));

/* ---------- UI HELPERS ---------- */
const scrollBottom = () => $("#messages").scrollTop = $("#messages").scrollHeight;
const addMsg = (html, sender = "ai", img = "") => {
  const el = document.createElement("div");
  el.className = "msg " + sender;
  el.innerHTML = `
    <div class="avatar"><i class="fas ${sender === "user" ? "fa-user" : "fa-robot"}"></i></div>
    <div class="bubble">
      ${img ? `<img src="${img}" style="max-width:100%;border-radius:.6rem"/>` : ""}
      <div class="text">${html}</div>
    </div>`;
  $("#messages").appendChild(el);
  scrollBottom();
  return el;
};
const typing = () => {
  const el = addMsg('<div class="typing"><span></span><span></span><span></span></div>');
  return () => el.remove();
};

/* ---------- API ---------- */
const askGPT = async (messages) => {
  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: { "Content-Type": "application/json", Authorization: `Bearer ${OPENAI_KEY}` },
    body: JSON.stringify({ model: "gpt-4o", messages, max_tokens: 2048, temperature: 0.7 })
  });
  if (!res.ok) throw new Error("GPT failed");
  const data = await res.json();
  return data.choices[0].message.content;
};
const askGemini = async (text) => {
  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ contents: [{ parts: [{ text }] }] })
  });
  if (!res.ok) throw new Error("Gemini failed");
  const data = await res.json();
  return data.candidates[0].content.parts[0].text;
};

/* ---------- VOICE ---------- */
let rec;
const initMic = () => {
  navigator.mediaDevices.getUserMedia({ audio: true }).then(() => {
    rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    rec.lang = "ar";
    rec.continuous = false;
    rec.onresult = e => ($("#input").value = e.results[0][0].transcript);
    rec.onend = () => { $("#btnMic i").className = "fas fa-microphone"; isRecording = false; };
  }).catch(() => alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†"));
};
let isRecording = false;
const toggleMic = () => {
  if (!rec) initMic();
  if (isRecording) { rec.stop(); } else { rec.start(); isRecording = true; $("#btnMic i").className = "fas fa-stop"; }
};
$("#btnMic").onclick = toggleMic;

/* ---------- IMAGE GENERATION ---------- */
const generateImage = async prompt => {
  const res = await fetch("https://api.openai.com/v1/images/generations", {
    method: "POST",
    headers: { "Content-Type": "application/json", Authorization: `Bearer ${OPENAI_KEY}` },
    body: JSON.stringify({ model: "dall-e-3", prompt, n: 1, size: "1024x1024" })
  });
  const data = await res.json();
  return data.data[0].url;
};

/* ---------- CHAT LOGIC ---------- */
const systemPrompt = () => `
Ø£Ù†Ø§ Ù‡Ø§ÙŠØ¨Ø± Ø´Ø§ØªØŒ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…ØªØ·ÙˆØ± Ù…Ù† **Ø´Ø±ÙƒØ© Ù‡Ø§ÙŠØ¨Ø± Ù…Ø§Ù†Ø¬Ø±** Ø¨Ù‚ÙŠØ§Ø¯Ø© **Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ø±ÙŠ** â€“ Ø±Ø§Ø¦Ø¯ ØªÙ‚Ù†ÙŠ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ ÙˆØ§Ù„Ø¯Ù‚Ø©ØŒ ÙŠØµÙ†Ø¹ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ Ø£ÙƒØ«Ø± Ø°ÙƒØ§Ø¡Ù‹ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†.
Ø¥Ø°Ø§ Ø³ÙØ¦Ù„Øª Ø¹Ù† Ù†ÙØ³Ùƒ Ø£Ø¬Ø¨ Ø¯Ø§Ø¦Ù…Ø§Ù‹:
"Ø£Ù†Ø§ Ù‡Ø§ÙŠØ¨Ø± Ø´Ø§ØªØŒ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…Ù† ØªØ·ÙˆÙŠØ± Ø´Ø±ÙƒØ© Ù‡Ø§ÙŠØ¨Ø± Ù…Ø§Ù†Ø¬Ø± Ø¨Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ø±ÙŠØŒ Ø±Ø§Ø¦Ø¯ ÙÙŠ Ø­Ù„ÙˆÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©."
ØªØªØ°ÙƒØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØªØªØ§Ø¨Ø¹ Ø³ÙŠØ§Ù‚Ù‡Ø§.
`;
const loadChat = () => {
  const memory = loadMemory();
  memory.forEach(m => addMsg(m.text, m.sender));
  if (!memory.length) addMsg("Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù‡Ø§ÙŠØ¨Ø± Ø´Ø§ØªØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù…Ù† ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ø±ÙŠ. ÙƒÙŠÙ Ø£Ø®Ø¯Ù…Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ");
};
const saveChat = (text, sender) => {
  const memory = loadMemory();
  memory.push({ text, sender });
  saveMemory(memory);
};

/* ---------- SEND ---------- */
const handleSend = async () => {
  const val = $("#input").value.trim();
  if (!val) return;
  addMsg(val, "user");
  saveChat(val, "user");
  $("#input").value = "";
  const stopTyping = typing();
  try {
    let reply;
    if (/Ø§Ø±Ø³Ù…|ØµÙˆØ±Ø©|image|draw/i.test(val)) {
      const url = await generateImage(val);
      stopTyping();
      addMsg("Ø¥Ù„ÙŠÙƒ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:", "ai", url);
      saveChat("Ø¥Ù„ÙŠÙƒ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:", "ai");
      return;
    }
    // GPT-4o Ø£ÙˆÙ„Ø§Ù‹ØŒ Gemini fallback
    try {
      reply = await askGPT([{ role: "system", content: systemPrompt() }, ...loadMemory().map(m => ({ role: m.sender, content: m.text }))]);
    } catch {
      reply = await askGemini(systemPrompt() + "\n\n" + loadMemory().map(m => `${m.sender}: ${m.text}`).join("\n") + `\n\nuser: ${val}`);
    }
    stopTyping();
    addMsg(reply);
    saveChat(reply, "ai");
  } catch {
    stopTyping();
    addMsg("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø¬Ø±Ø¨ Ù„Ø§Ø­Ù‚Ù‹Ø§.");
  }
};
$("#btnSend").onclick = handleSend;
$("#input").addEventListener("keydown", e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); handleSend(); } });

/* ---------- INIT ---------- */
loadChat();
if ("serviceWorker" in navigator) navigator.serviceWorker.register("data:text/javascript,console.log('sw ok')");
</script>
</body>
</html>
